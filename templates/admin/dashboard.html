{% extends "base.html" %}

{% block title %}Admin Dashboard - Nkuna Burial Society{% endblock %}

{% block extra_css %}
<style>
    /* Admin Dashboard Specific Styles */
    .dashboard-header {
        background: linear-gradient(135deg, #0f172a 0%, var(--primary-dark) 100%);
        color: white;
        padding: 3rem 0;
        border-bottom: 3px solid var(--primary-teal);
        margin-bottom: 2rem;
    }
    
    .dashboard-title {
        font-size: 2.5rem;
        font-weight: 800;
        background: linear-gradient(45deg, #38bdf8, #7dd3fc);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
    }
    
    /* Stat Cards */
    .stat-card-admin {
        background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
        color: white;
        border-radius: 16px;
        padding: 1.5rem;
        height: 100%;
        transition: var(--transition);
        border: 2px solid #475569;
        position: relative;
        overflow: hidden;
    }
    
    .stat-card-admin::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(45deg, transparent, rgba(14, 165, 233, 0.1), transparent);
        transform: translateX(-100%);
        transition: transform 0.6s ease;
    }
    
    .stat-card-admin:hover::before {
        transform: translateX(100%);
    }
    
    .stat-card-admin:hover {
        transform: translateY(-8px);
        border-color: var(--primary-teal);
        box-shadow: 0 15px 30px rgba(14, 165, 233, 0.2);
    }
    
    .stat-icon {
        width: 60px;
        height: 60px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        margin-bottom: 1rem;
        transition: var(--transition);
    }
    
    .stat-card-admin:hover .stat-icon {
        transform: scale(1.1) rotate(5deg);
    }
    
    .stat-number {
        font-size: 2.5rem;
        font-weight: 800;
        line-height: 1;
        margin: 0.5rem 0;
        background: linear-gradient(45deg, var(--primary-teal), var(--accent-gold));
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
    }
    
    /* Quick Actions */
    .action-card {
        background: var(--card-bg);
        border-radius: 16px;
        padding: 1.5rem;
        text-align: center;
        transition: var(--transition);
        border: 2px solid transparent;
        position: relative;
        overflow: hidden;
    }
    
    .action-card::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
        background: linear-gradient(90deg, var(--primary-teal), var(--accent-gold));
        transform: scaleX(0);
        transform-origin: left;
        transition: transform 0.5s ease;
    }
    
    .action-card:hover::after {
        transform: scaleX(1);
    }
    
    .action-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        border-color: var(--primary-teal);
    }
    
    .action-icon {
        width: 70px;
        height: 70px;
        background: linear-gradient(135deg, var(--primary-teal), #38bdf8);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1rem;
        font-size: 1.5rem;
        color: white;
        transition: var(--transition);
    }
    
    .action-card:hover .action-icon {
        transform: rotateY(180deg);
        background: linear-gradient(135deg, var(--accent-gold), #fbbf24);
    }
    
    /* Recent Activities */
    .activity-timeline {
        position: relative;
        padding-left: 2rem;
    }
    
    .activity-timeline::before {
        content: '';
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 3px;
        background: linear-gradient(to bottom, var(--primary-teal), var(--accent-gold));
        border-radius: 3px;
    }
    
    .activity-item {
        position: relative;
        padding: 1rem 0 1rem 1.5rem;
        border-bottom: 1px solid #e2e8f0;
        transition: var(--transition);
    }
    
    .activity-item:last-child {
        border-bottom: none;
    }
    
    .activity-item::before {
        content: '';
        position: absolute;
        left: -0.5rem;
        top: 1.5rem;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: var(--primary-teal);
        border: 3px solid white;
        box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.3);
        transition: var(--transition);
    }
    
    .activity-item:hover::before {
        background: var(--accent-gold);
        transform: scale(1.3);
        box-shadow: 0 0 0 5px rgba(251, 191, 36, 0.3);
    }
    
    .activity-item:hover {
        padding-left: 2rem;
        background: linear-gradient(90deg, rgba(14, 165, 233, 0.05), transparent);
        border-radius: 8px;
    }
    
    /* Claims Table */
    .claims-table {
        background: var(--card-bg);
        border-radius: 16px;
        overflow: hidden;
        box-shadow: var(--shadow-md);
    }
    
    .claims-table thead th {
        background: linear-gradient(135deg, var(--primary-dark), #1e293b);
        color: white;
        border: none;
        padding: 1rem;
        font-weight: 600;
    }
    
    .claims-table tbody tr {
        transition: var(--transition);
        border-bottom: 1px solid #e2e8f0;
    }
    
    .claims-table tbody tr:last-child {
        border-bottom: none;
    }
    
    .claims-table tbody tr:hover {
        background: linear-gradient(90deg, rgba(14, 165, 233, 0.08), rgba(251, 191, 36, 0.05));
        transform: scale(1.01);
    }
    
    .claims-table tbody td {
        padding: 1rem;
        vertical-align: middle;
        border: none;
    }
    
    .status-badge {
        padding: 0.4rem 0.8rem;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
        display: inline-block;
        transition: var(--transition);
    }
    
    .status-badge:hover {
        transform: scale(1.05);
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
    }
    
    .status-pending {
        background: linear-gradient(135deg, #fbbf24, #f59e0b);
        color: white;
    }
    
    .status-approved {
        background: linear-gradient(135deg, #10b981, #059669);
        color: white;
    }
    
    .status-rejected {
        background: linear-gradient(135deg, #ef4444, #dc2626);
        color: white;
    }
    
    .status-under_review {
        background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        color: white;
    }
    
    /* Chart Container */
    .chart-container {
        background: var(--card-bg);
        border-radius: 16px;
        padding: 1.5rem;
        box-shadow: var(--shadow-md);
        transition: var(--transition);
    }
    
    .chart-container:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-lg);
    }
    
    /* Quick Stats Grid */
    .quick-stat {
        background: linear-gradient(135deg, rgba(14, 165, 233, 0.1), rgba(251, 191, 36, 0.05));
        border-radius: 12px;
        padding: 1rem;
        text-align: center;
        transition: var(--transition);
        border: 1px solid rgba(14, 165, 233, 0.2);
    }
    
    .quick-stat:hover {
        background: linear-gradient(135deg, rgba(14, 165, 233, 0.2), rgba(251, 191, 36, 0.1));
        transform: translateY(-3px);
        border-color: var(--primary-teal);
    }
    
    /* Admin Alert */
    .admin-alert {
        background: linear-gradient(135deg, rgba(251, 191, 36, 0.1), rgba(14, 165, 233, 0.05));
        border: 2px solid var(--accent-gold);
        border-radius: 12px;
        padding: 1rem;
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0% { box-shadow: 0 0 0 0 rgba(251, 191, 36, 0.4); }
        70% { box-shadow: 0 0 0 10px rgba(251, 191, 36, 0); }
        100% { box-shadow: 0 0 0 0 rgba(251, 191, 36, 0); }
    }
    
    /* Filter Tabs */
    .filter-tabs .nav-link {
        background: transparent;
        color: var(--text-light);
        border: none;
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
        transition: var(--transition);
        position: relative;
    }
    
    .filter-tabs .nav-link.active {
        background: linear-gradient(135deg, var(--primary-teal), #0284c7);
        color: white;
        box-shadow: var(--shadow-md);
    }
    
    .filter-tabs .nav-link:hover:not(.active) {
        color: var(--primary-teal);
        background: rgba(14, 165, 233, 0.1);
    }
    
    /* Responsive */
    @media (max-width: 768px) {
        .dashboard-title {
            font-size: 2rem;
        }
        
        .stat-number {
            font-size: 2rem;
        }
        
        .activity-timeline {
            padding-left: 1.5rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Dashboard Header -->
<section class="dashboard-header">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h1 class="dashboard-title">Admin Dashboard</h1>
                <p class="lead mb-0">Complete system overview and management</p>
            </div>
            <div class="col-md-4 text-md-end">
                <div class="admin-alert">
                    <i class="fas fa-crown me-2"></i>
                    <strong>Administrator:</strong> {{ current_user.first_name }} {{ current_user.last_name }}
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Main Dashboard Content -->
<div class="container">
    <!-- Statistics Row -->
    <div class="row g-4 mb-4">
        <div class="col-xl-3 col-md-6">
            <div class="stat-card-admin">
                <div class="stat-icon" style="background: linear-gradient(135deg, #0ea5e9, #38bdf8);">
                    <i class="fas fa-users"></i>
                </div>
                <h6 class="text-uppercase text-light mb-2">Total Users</h6>
                <div class="stat-number">{{ total_users }}</div>
                <p class="text-light mb-0">Active members registered</p>
            </div>
        </div>
        
        <div class="col-xl-3 col-md-6">
            <div class="stat-card-admin">
                <div class="stat-icon" style="background: linear-gradient(135deg, #10b981, #34d399);">
                    <i class="fas fa-file-contract"></i>
                </div>
                <h6 class="text-uppercase text-light mb-2">Active Policies</h6>
                <div class="stat-number">{{ total_policies }}</div>
                <p class="text-light mb-0">Policies in the system</p>
            </div>
        </div>
        
        <div class="col-xl-3 col-md-6">
            <div class="stat-card-admin">
                <div class="stat-icon" style="background: linear-gradient(135deg, #f59e0b, #fbbf24);">
                    <i class="fas fa-hand-holding-heart"></i>
                </div>
                <h6 class="text-uppercase text-light mb-2">Total Claims</h6>
                <div class="stat-number">{{ total_claims }}</div>
                <p class="text-light mb-0">{{ pending_claims }} pending review</p>
            </div>
        </div>
        
        <div class="col-xl-3 col-md-6">
            <div class="stat-card-admin">
                <div class="stat-icon" style="background: linear-gradient(135deg, #8b5cf6, #a78bfa);">
                    <i class="fas fa-money-bill-wave"></i>
                </div>
                <h6 class="text-uppercase text-light mb-2">Total Deposits</h6>
                <div class="stat-number">R{{ "%.2f"|format(total_deposits) }}</div>
                <p class="text-light mb-0">R{{ "%.2f"|format(total_fees) }} in fees</p>
            </div>
        </div>
    </div>
    
    <!-- Quick Actions & Recent Activities Row -->
    <div class="row g-4 mb-4">
        <!-- Quick Actions -->
        <div class="col-lg-4">
            <div class="card-modern h-100">
                <div class="card-body">
                    <h5 class="card-title gradient-text mb-4">
                        <i class="fas fa-bolt me-2"></i> Quick Actions
                    </h5>
                    <div class="row g-3">
                        <div class="col-6">
                            <a href="{{ url_for('admin.manage_users') }}" class="text-decoration-none">
                                <div class="action-card">
                                    <div class="action-icon">
                                        <i class="fas fa-users-cog"></i>
                                    </div>
                                    <h6>Manage Users</h6>
                                    <small class="text-muted">View & manage members</small>
                                </div>
                            </a>
                        </div>
                        <div class="col-6">
                            <a href="{{ url_for('admin.manage_claims') }}" class="text-decoration-none">
                                <div class="action-card">
                                    <div class="action-icon">
                                        <i class="fas fa-tasks"></i>
                                    </div>
                                    <h6>Process Claims</h6>
                                    <small class="text-muted">Review pending claims</small>
                                </div>
                            </a>
                        </div>
                        <div class="col-6">
                            <a href="{{ url_for('admin.reports') }}" class="text-decoration-none">
                                <div class="action-card">
                                    <div class="action-icon">
                                        <i class="fas fa-chart-bar"></i>
                                    </div>
                                    <h6>View Reports</h6>
                                    <small class="text-muted">Financial analytics</small>
                                </div>
                            </a>
                        </div>
                        <div class="col-6">
                            <a href="{{ url_for('admin.manage_fees') }}" class="text-decoration-none">
                                <div class="action-card">
                                    <div class="action-icon">
                                        <i class="fas fa-cog"></i>
                                    </div>
                                    <h6>System Settings</h6>
                                    <small class="text-muted">Configure fees & rules</small>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Recent Activities -->
        <div class="col-lg-8">
            <div class="card-modern h-100">
                <div class="card-body">
                    <h5 class="card-title gradient-text mb-4">
                        <i class="fas fa-history me-2"></i> Recent Activities
                    </h5>
                    
                    {% if recent_activities %}
                    <div class="activity-timeline">
                        {% for activity in recent_activities %}
                        <div class="activity-item">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <h6 class="mb-1">
                                        {% if activity.action == 'login' %}
                                            <i class="fas fa-sign-in-alt text-success me-2"></i>
                                        {% elif activity.action == 'logout' %}
                                            <i class="fas fa-sign-out-alt text-warning me-2"></i>
                                        {% elif activity.action == 'registration' %}
                                            <i class="fas fa-user-plus text-primary me-2"></i>
                                        {% elif activity.action == 'deposit' %}
                                            <i class="fas fa-money-bill-wave text-success me-2"></i>
                                        {% elif activity.action == 'claim_submitted' %}
                                            <i class="fas fa-file-medical text-info me-2"></i>
                                        {% else %}
                                            <i class="fas fa-bell text-secondary me-2"></i>
                                        {% endif %}
                                        {{ activity.action|replace('_', ' ')|title }}
                                    </h6>
                                    <p class="text-muted mb-0 small">
                                        {{ activity.details|default('System activity') }}
                                    </p>
                                </div>
                                <small class="text-muted">{{ activity.created_at.strftime('%H:%M') }}</small>
                            </div>
                            {% if activity.user_id %}
                            <small class="text-muted">
                                User ID: {{ activity.user_id }}
                                {% if activity.ip_address %}
                                â€¢ IP: {{ activity.ip_address }}
                                {% endif %}
                            </small>
                            {% endif %}
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="text-center py-5">
                        <i class="fas fa-history fa-3x text-muted mb-3"></i>
                        <p class="text-muted">No recent activities</p>
                    </div>
                    {% endif %}
                    
                    <div class="text-center mt-3">
                        <a href="{{ url_for('admin.activity_log') }}" class="btn btn-modern btn-sm">
                            <i class="fas fa-list me-2"></i> View All Activities
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Urgent Claims & Quick Stats Row -->
    <div class="row g-4 mb-4">
        <!-- Urgent Claims -->
        <div class="col-lg-8">
            <div class="card-modern">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h5 class="card-title gradient-text mb-0">
                            <i class="fas fa-exclamation-triangle me-2"></i> Urgent Claims
                        </h5>
                        <div class="filter-tabs">
                            <ul class="nav nav-pills">
                                <li class="nav-item">
                                    <a class="nav-link active" href="{{ url_for('admin.manage_claims') }}?status=pending">
                                        Pending ({{ pending_claims }})
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="{{ url_for('admin.manage_claims') }}?status=under_review">
                                        Under Review
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    
                    {% if urgent_claims %}
                    <div class="table-responsive">
                        <table class="table claims-table">
                            <thead>
                                <tr>
                                    <th>Claim #</th>
                                    <th>Policy Holder</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                    <th>Submitted</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for claim in urgent_claims %}
                                <tr>
                                    <td>
                                        <strong>{{ claim.claim_number }}</strong>
                                    </td>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <div class="flex-shrink-0">
                                                <i class="fas fa-user-circle fa-lg text-muted"></i>
                                            </div>
                                            <div class="flex-grow-1 ms-2">
                                                <small class="d-block fw-bold">{{ claim.claimant.get_full_name() }}</small>
                                                <small class="text-muted">Policy: {{ claim.policy.policy_number }}</small>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="fw-bold">R{{ "%.2f"|format(claim.claim_amount) }}</td>
                                    <td>
                                        <span class="status-badge status-{{ claim.status }}">
                                            {{ claim.status|replace('_', ' ')|title }}
                                        </span>
                                    </td>
                                    <td>
                                        <small class="text-muted">{{ claim.created_at.strftime('%d %b %Y') }}</small>
                                    </td>
                                    <td>
                                        <a href="{{ url_for('admin.review_claim', claim_id=claim.id) }}" 
                                           class="btn btn-sm btn-modern">
                                            <i class="fas fa-eye me-1"></i> Review
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <div class="text-center py-4">
                        <i class="fas fa-check-circle fa-3x text-success mb-3"></i>
                        <h5 class="text-muted">No urgent claims at the moment</h5>
                        <p class="text-muted">All claims are processed</p>
                    </div>
                    {% endif %}
                    
                    <div class="text-center mt-3">
                        <a href="{{ url_for('admin.manage_claims') }}" class="btn btn-modern">
                            <i class="fas fa-list me-2"></i> View All Claims
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Quick Stats -->
        <div class="col-lg-4">
            <div class="card-modern h-100">
                <div class="card-body">
                    <h5 class="card-title gradient-text mb-4">
                        <i class="fas fa-chart-line me-2"></i> Quick Stats
                    </h5>
                    
                    <div class="row g-3">
                        <div class="col-6">
                            <div class="quick-stat">
                                <div class="mb-2">
                                    <i class="fas fa-user-plus fa-2x text-primary"></i>
                                </div>
                                <h5 class="stat-number">{{ (total_users/30)|round|int }}</h5>
                                <small class="text-muted">New users/month</small>
                            </div>
                        </div>
                        
                        <div class="col-6">
                            <div class="quick-stat">
                                <div class="mb-2">
                                    <i class="fas fa-hand-holding-usd fa-2x text-success"></i>
                                </div>
                                <h5 class="stat-number">R{{ "%.0f"|format(total_deposits/30) }}</h5>
                                <small class="text-muted">Avg deposits/day</small>
                            </div>
                        </div>
                        
                        <div class="col-6">
                            <div class="quick-stat">
                                <div class="mb-2">
                                    <i class="fas fa-clock fa-2x text-warning"></i>
                                </div>
                                <h5 class="stat-number">48h</h5>
                                <small class="text-muted">Avg claim processing</small>
                            </div>
                        </div>
                        
                        <div class="col-6">
                            <div class="quick-stat">
                                <div class="mb-2">
                                    <i class="fas fa-percentage fa-2x text-info"></i>
                                </div>
                                <h5 class="stat-number">98.5%</h5>
                                <small class="text-muted">System uptime</small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Today's Summary -->
                    <div class="mt-4 pt-3 border-top">
                        <h6 class="fw-bold mb-3">Today's Summary</h6>
                        <div class="d-flex justify-content-between mb-2">
                            <span class="text-muted">New Users:</span>
                            <span class="fw-bold">{% if total_users_today %}{{ total_users_today }}{% else %}0{% endif %}</span>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span class="text-muted">Deposits:</span>
                            <span class="fw-bold text-success">R{% if total_deposits_today %}{{ "%.2f"|format(total_deposits_today) }}{% else %}0.00{% endif %}</span>
                        </div>
                        <div class="d-flex justify-content-between">
                            <span class="text-muted">Active Members:</span>
                            <span class="fw-bold text-info">{{ active_members }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Charts Section -->
    <div class="row g-4 mb-4">
        <div class="col-lg-8">
            <div class="chart-container">
                <h5 class="gradient-text mb-4">
                    <i class="fas fa-chart-pie me-2"></i> Financial Overview (Last 30 Days)
                </h5>
                <div id="financialChart" style="height: 300px;">
                    <!-- Chart will be rendered here via JavaScript -->
                    <div class="text-center py-5">
                        <i class="fas fa-chart-bar fa-3x text-muted mb-3"></i>
                        <p class="text-muted">Financial chart would display here</p>
                        <p class="small text-muted">Showing deposits, fees, and payouts over time</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4">
            <div class="card-modern h-100">
                <div class="card-body">
                    <h5 class="card-title gradient-text mb-4">
                        <i class="fas fa-bell me-2"></i> System Notifications
                    </h5>
                    
                    <div class="list-group list-group-flush">
                        <div class="list-group-item border-0 px-0 py-2">
                            <div class="d-flex align-items-center">
                                <div class="flex-shrink-0">
                                    <i class="fas fa-check-circle text-success"></i>
                                </div>
                                <div class="flex-grow-1 ms-3">
                                    <small class="text-muted">System running optimally</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="list-group-item border-0 px-0 py-2">
                            <div class="d-flex align-items-center">
                                <div class="flex-shrink-0">
                                    <i class="fas fa-database text-primary"></i>
                                </div>
                                <div class="flex-grow-1 ms-3">
                                    <small class="text-muted">Database: 24.5MB used</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="list-group-item border-0 px-0 py-2">
                            <div class="d-flex align-items-center">
                                <div class="flex-shrink-0">
                                    <i class="fas fa-shield-alt text-warning"></i>
                                </div>
                                <div class="flex-grow-1 ms-3">
                                    <small class="text-muted">Last backup: 2 hours ago</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="list-group-item border-0 px-0 py-2">
                            <div class="d-flex align-items-center">
                                <div class="flex-shrink-0">
                                    <i class="fas fa-user-clock text-info"></i>
                                </div>
                                <div class="flex-grow-1 ms-3">
                                    <small class="text-muted">{{ pending_claims }} claims need attention</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <a href="{{ url_for('admin.reports') }}" class="btn btn-modern w-100">
                            <i class="fas fa-download me-2"></i> Generate Full Report
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Initialize tooltips
    document.addEventListener('DOMContentLoaded', function() {
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });
        
        // Animate stat numbers on scroll
        const statNumbers = document.querySelectorAll('.stat-number');
        
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const stat = entry.target;
                    const target = parseInt(stat.textContent.replace(/[^0-9]/g, ''));
                    const duration = 1500;
                    const increment = target / (duration / 16);
                    let current = 0;
                    
                    const timer = setInterval(() => {
                        current += increment;
                        if (current >= target) {
                            stat.textContent = stat.textContent.replace(/[0-9]+/, target.toLocaleString());
                            clearInterval(timer);
                        } else {
                            const displayNum = Math.floor(current).toLocaleString();
                            stat.textContent = stat.textContent.replace(/[0-9,]+/, displayNum);
                        }
                    }, 16);
                    
                    observer.unobserve(stat);
                }
            });
        }, { threshold: 0.5 });
        
        statNumbers.forEach(stat => observer.observe(stat));
        
        // Auto-refresh urgent claims every 30 seconds
        setInterval(() => {
            fetch('/admin/api/dashboard-stats')
                .then(response => response.json())
                .then(data => {
                    // Update pending claims count
                    const pendingBadge = document.querySelector('.nav-link.active .badge');
                    if (pendingBadge) {
                        pendingBadge.textContent = data.pending_claims;
                    }
                    
                    // Update today's deposits
                    const depositsToday = document.querySelector('.fw-bold.text-success');
                    if (depositsToday && data.total_deposits_today) {
                        depositsToday.textContent = 'R' + data.total_deposits_today.toFixed(2);
                    }
                    
                    // Update active members count
                    const activeMembersSpan = document.querySelector('.fw-bold.text-info');
                    if (activeMembersSpan && data.active_members) {
                        activeMembersSpan.textContent = data.active_members;
                    }
                })
                .catch(error => console.log('Auto-refresh failed:', error));
        }, 30000);
        
        // Add hover effect to status badges
        document.querySelectorAll('.status-badge').forEach(badge => {
            badge.addEventListener('mouseenter', function() {
                this.style.transform = 'scale(1.1)';
                this.style.boxShadow = '0 5px 15px rgba(0,0,0,0.2)';
            });
            
            badge.addEventListener('mouseleave', function() {
                this.style.transform = 'scale(1)';
                this.style.boxShadow = 'none';
            });
        });
    });
</script>
{% endblock %}